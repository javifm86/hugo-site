<script type="text/javascript">
    (function () {
      const $containerSelector = document.getElementById(
        "containerLanguageSelector"
      );
      const $languageList = document.getElementById("languageList");
      const $buttonLanguageSelector = document.getElementById(
        "buttonLanguageSelector"
      );
      const $languageItems = document.querySelectorAll("#languageList li");

      $buttonLanguageSelector.addEventListener("click", function (e) {
        $languageList.classList.toggle("hidden");
      });

      $languageItems.forEach((item) => {
        item.addEventListener("click", function (e) {
          window.location.href = this.dataset.url;
        });
        item.addEventListener("keypress", function ({ key }) {
          if (key === "Enter" || key === "Space") {
            window.location.href = this.dataset.url;
          }
        });
      });

      document.addEventListener("click", function (event) {
        if (!$containerSelector.contains(event.target) && isOpenSelector()) {
          $languageList.classList.add("hidden");
        }
      });

      document.addEventListener("keydown", function (event) {
        const { key } = event;
        const isOpen = isOpenSelector();

        if(!isOpen) {
          return;
        }

        if (key === "Escape" || key === "Tab") {
          closeSelector();
          return;
        }

        if (key === "ArrowUp") {
          event.preventDefault();

          if (document.activeElement.previousElementSibling !== null) {
            document.activeElement.previousElementSibling.focus();
          }
          return;
        }

        if (key === "ArrowDown") {
          event.preventDefault();

          if (selectorHasFocus()) {
            $languageItems[0].focus();
          } else if (
            focusedIsLanguageOption() &&
            document.activeElement.nextElementSibling !== null
          ) {
            document.activeElement.nextElementSibling.focus();
          }
          return;
        }
      });

      function isOpenSelector() {
        return !$languageList.classList.contains("hidden");
      }

      function closeSelector() {
        $languageList.classList.add("hidden");
        if(focusedIsLanguageOption()) {
          $buttonLanguageSelector.focus();
        }
      }

      function selectorHasFocus() {
        return document.activeElement.isSameNode($buttonLanguageSelector);
      }

      function focusedIsLanguageOption() {
        return document.activeElement
          .getAttribute("id")
          .includes("listbox-option-");
      }

      function isLanguageOption(node) {
        return node.getAttribute("id").includes("listbox-option-");
      }
    })();
</script>
